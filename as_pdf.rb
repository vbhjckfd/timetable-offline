require 'parallel'
require 'ruby-progressbar'

stops = [727,745,744,707,354,317,733,197,752,1016,803,802,765,764,769,770,621,56,55,297,735,757,758,416,296,361,750,706,734,227,762,628,280,281,730,729,737,170,577,779,392,523,1141,311,312,1142,514,780,385,544,146,148,728,150,117,753,794,801,438,437,422,5,8,291,39,67,68,1032,9,358,362,439,800,72,357,359,105,103,106,107,108,109,1007,1005,1021,206,766,207,1006,738,771,749,238,239,225,226,246,754,789,786,785,784,787,788,778,777,796,797,495,763,70,712,711,306,736,393,4,795,324,782,783,790,791,302,310,322,303,1020,1024,739,547,751,1185,1186,1004,1031,1030,773,774,775,776,285,793,792,73,708,382,384,391,375,510,509,299,569,644,503,118,188,187,679,504,502,500,501,519,516,517,294,293,468,469,499,465,511,527,555,466,467,27,43,28,37,34,35,74,250,247,248,251,286,63,58,61,2,3,23,642,640,630,645,671,672,641,244,704,579,581,580,584,676,673,674,675,678,505,661,78,781,41,71,48,256,1077,52,1171,1177,1178,1194,1193,295,1180,772,326,367,759,760,390,386,411,767,768,1025,1182,1181,1183,1119,85,19,51,50,1060,237,746,26,298,417,713,574,62,625,152,155,151,154,153,665,664,546,366,368,414,473,472,79,64,471,1,415,489,488,592,12,11,487,490,1002,1009,1003,255,233,232,276,570,660,639,572,277,235,234,520,387,388,389,396,395,381,522,669,670,360,743,668,1013,1015,1017,1018,262,261,254,257,258,259,1019,1023,1008,1014,1012,1010,1001,81,406,29,21,91,92,88,164,193,165,93,87,89,90,172,174,49,171,173,132,38,33,401,402,212,1184,1108,99,98,97,624,101,104,1107,1118,364,355,86,356,216,283,663,666,571,647,646,705,32,59,573,667,265,275,554,126,560,266,66,20,31,36,218,220,221,222,223,224,271,10,211,209,208,205,1072,1073,1075,1074,1076,1067,1071,316,521,525,515,526,470,338,44,512,513,524,518,315,314,95,236,231,289,274,228,230,200,204,202,198,210,370,371,337,374,373,215,214,287,279,377,213,201,203,199,288,229,273,272,249,243,241,240,292,567,75,428,566,558,76,80,333,30,253,77,182,183,141,162,158,159,160,157,163,683,682,681,680,149,147,536,156,13,40,57,242,245,252,278,267,269,270,268,284,282,363,365,372,369,25,24,219,217,65,556,557,46,42,111,424,444,120,121,168,169,116,102,115,166,167,119,122,426,178,175,192,196,478,404,408,421,336,335,334,413,378,423,394,398,399,409,410,400,397,380,379,376,412,331,420,419,403,429,195,194,176,177,696,627,622,596,602,599,604,607,605,658,662,619,659,601,600,603,598,597,629,180,181,142,186,685,686,688,690,702,699,700,693,656,655,657,698,695,694,701,692,691,689,687,761,332,139,140,179,564,563,562,561,135,134,133,127,124,498,96,190,191,189,496,497,114,100,125,128,129,130,131,432,433,435,434,320,1192,587,585,583,582,494,535,530,484,482,481,479,568,508,436,431,430,565,559,480,483,486,485,529,113,110,53,586,588,590,591,589,1191,313,6,653,654,651,1068,1061,1059,1058,1063,1057,1053,1045,1056,1054,1052,1051,1062,1064,1065,1069,1066,652,650,649,69,595,576,635,633,631,636,614,617,618,613,616,615,7,14,16,15,18,47,474,475,476,477,532,534,533,549,545,541,539,552,553,443,442,446,448,450,452,455,456,458,459,418,457,454,453,451,449,440,441,445,537,538,550,548,540,1029,551,138,136,137,531,493,492,491,528,94,17,60,54,608,609,610,611,612,648,637,638,632,634,1033,575,593,1111,1102,1123,1104,1103,1106,1105,1125,1126,1124,1121,1122].sort

Parallel.each_with_index(stops, in_threads: 5, progress: "Generating") do |stop, index|
    #url = "https://offline.lad.lviv.ua/#{stop}"
    url = "http://localhost:4567/#{stop}"
    file_path = "/Users/mholyak/Downloads/sticker-svg/#{stop}.pdf"
    #tiff_file_path = "/Users/mholyak/Downloads/stickers/#{stop}.tiff"
    #p url
    #p file_path

    if !File.exist?(file_path) || ARGV[0]
        result = system("wkhtmltopdf -q --page-height 350mm --page-width 500mm -B 0 -L 0 -R 0 -T 0 --zoom 0.5 '#{url}' '#{file_path}'")
        puts url if (!result)
    end
end